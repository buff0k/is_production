{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2025-10-08 06:15:18.113617",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Hourly Production",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "<style>\r\n  @media print {\r\n    @page { size: A4 landscape; margin: 10mm; }\r\n    body { -webkit-print-color-adjust: exact; print-color-adjust: exact; }\r\n  }\r\n\r\n  body {\r\n    font-family: Arial, sans-serif;\r\n    font-size: 11px;\r\n    color: #000;\r\n  }\r\n\r\n  h2.report-title {\r\n    text-align: center;\r\n    color: #1F4E79;\r\n    margin-bottom: 6px;\r\n    font-size: 18px;\r\n  }\r\n\r\n  .header-info {\r\n    text-align: center;\r\n    font-size: 13px;\r\n    margin-bottom: 8px;\r\n    white-space: nowrap;\r\n  }\r\n\r\n  .header-info input.shift-box {\r\n    border: 1px solid #000;\r\n    border-radius: 3px;\r\n    padding: 0 2px;\r\n    font-size: 11px;\r\n    text-align: center;\r\n    width: 1cm;\r\n    height: 0.6cm;\r\n    font-weight: bold;\r\n    display: inline-block;\r\n    background-color: #fff2cc;\r\n    margin-left: 2px;\r\n    vertical-align: middle;\r\n  }\r\n\r\n  table {\r\n    border-collapse: collapse;\r\n    width: 100%;\r\n    margin-bottom: 10px;\r\n  }\r\n\r\n  th, td {\r\n    border: 1px solid #000;\r\n    padding: 4px 6px;\r\n    text-align: center;\r\n    vertical-align: middle;\r\n  }\r\n\r\n  th {\r\n    background-color: #d9e2f3;\r\n    color: #000;\r\n  }\r\n\r\n  .summary-cell {\r\n    background-color: #fff2cc;\r\n    font-weight: bold;\r\n  }\r\n\r\n  .section-title {\r\n    background-color: #1F4E79;\r\n    color: #fff;\r\n    text-align: left;\r\n    padding: 4px 6px;\r\n    font-size: 12px;\r\n  }\r\n\r\n  .two-column {\r\n    display: grid;\r\n    grid-template-columns: 70% 30%;\r\n    grid-gap: 10px;\r\n  }\r\n\r\n  .bottom-row {\r\n    display: grid;\r\n    grid-template-columns: 100%;\r\n  }\r\n\r\n  input[type=number] {\r\n    width: 90%;\r\n    text-align: center;\r\n    font-weight: bold;\r\n    border: 1px solid #ccc;\r\n    border-radius: 3px;\r\n    padding: 3px;\r\n  }\r\n</style>\r\n\r\n<h2 class=\"report-title\">Hour Report</h2>\r\n\r\n<div class=\"header-info\">\r\n  <b>Site:</b> {{ doc.location or '' }} &nbsp;&nbsp;| \r\n  <b>Shift:</b><input type=\"text\" class=\"shift-box\" id=\"manual_shift_input\" placeholder=\"\"> &nbsp;&nbsp;| \r\n  <b>Date:</b> {{ frappe.format_date(doc.prod_date) }} &nbsp;&nbsp;| \r\n  <b>Hour:</b> {{ doc.hour_slot or '' }}\r\n</div>\r\n\r\n<div class=\"two-column\">\r\n\r\n  <!-- LEFT COLUMN -->\r\n  <div>\r\n    <div class=\"section-title\">Excavator Production</div>\r\n    {% set excavators = {} %}\r\n    {% for row in doc.truck_loads %}\r\n      {% if row.asset_name_shoval and (row.loads or 0) > 0 %}\r\n        {% set ex = row.asset_name_shoval %}\r\n        {% if not excavators.get(ex) %}\r\n          {% set _ = excavators.update({ex: {\r\n            \"area\": row.mining_areas_trucks or '',\r\n            \"material\": row.geo_mat_layer_truck or '',\r\n            \"trucks\": [],\r\n            \"loads\": 0,\r\n            \"bcms\": 0\r\n          }}) %}\r\n        {% endif %}\r\n        {% set data = excavators[ex] %}\r\n        {% set _ = data[\"trucks\"].append(row.asset_name_truck) %}\r\n        {% set _ = data.update({\r\n          \"loads\": data[\"loads\"] + (row.loads or 0),\r\n          \"bcms\": data[\"bcms\"] + ((row.loads or 0) * (row.tub_factor or 0))\r\n        }) %}\r\n      {% endif %}\r\n    {% endfor %}\r\n\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Excavator</th>\r\n          <th>Mining Area</th>\r\n          <th>Material</th>\r\n          <th>Trucks</th>\r\n          <th>Loads</th>\r\n          <th>Volume (m\u00b3)</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {% for ex, data in excavators.items() %}\r\n          <tr>\r\n            <td>{{ ex }}</td>\r\n            <td>{{ data.area }}</td>\r\n            <td>{{ data.material }}</td>\r\n            <td>{{ \"{:,.0f}\".format((data.trucks | unique | list | length) or 0) }}</td>\r\n            <td>{{ \"{:,.0f}\".format(data.loads or 0) }}</td>\r\n            <td>{{ \"{:,.0f}\".format(data.bcms or 0) }}</td>\r\n          </tr>\r\n        {% endfor %}\r\n        {% if not excavators %}\r\n          <tr><td colspan=\"6\">No Excavator Data</td></tr>\r\n        {% endif %}\r\n      </tbody>\r\n    </table>\r\n\r\n    <div class=\"section-title\">Dozer Production</div>\r\n    {% set active_dozers = [] %}\r\n    {% for row in doc.dozer_production %}\r\n      {% if (row.bcm_hour or 0) > 0 %}\r\n        {% set _ = active_dozers.append(row) %}\r\n      {% endif %}\r\n    {% endfor %}\r\n\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Dozer</th>\r\n          <th>Mining Area</th>\r\n          <th>Material</th>\r\n          <th>Volume (m\u00b3)</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        {% for row in active_dozers %}\r\n          <tr>\r\n            <td>{{ row.asset_name or '' }}</td>\r\n            <td>{{ row.mining_areas_dozer_child or '' }}</td>\r\n            <td>{{ row.dozer_geo_mat_layer or '' }}</td>\r\n            <td>{{ \"{:,.0f}\".format(row.bcm_hour or 0) }}</td>\r\n          </tr>\r\n        {% endfor %}\r\n        {% if not active_dozers %}\r\n          <tr><td colspan=\"4\">No Dozer Data</td></tr>\r\n        {% endif %}\r\n      </tbody>\r\n    </table>\r\n\r\n    <div class=\"section-title\">Drill Production</div>\r\n    <table>\r\n      <thead>\r\n        <tr>\r\n          <th>Drill</th>\r\n          <th>Area</th>\r\n          <th>Meters</th>\r\n        </tr>\r\n      </thead>\r\n      <tbody>\r\n        <tr><td colspan=\"3\">No drill data available.</td></tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n\r\n  <!-- RIGHT COLUMN -->\r\n  <div>\r\n    <div class=\"section-title\">Monthly Statistics</div>\r\n\r\n    {% set survey = frappe.db.sql(\"SELECT total_surveyed_coal_tons, last_production_shift_start_date FROM `tabSurvey` WHERE location=%s ORDER BY last_production_shift_start_date DESC LIMIT 1\", (doc.location,), as_dict=True) %}\r\n    {% set survey_tons = survey[0].total_surveyed_coal_tons if survey else 0 %}\r\n    {% set survey_date = survey[0].last_production_shift_start_date if survey else None %}\r\n    {% set hourly_coal = frappe.db.sql(\"SELECT SUM(total_coal_bcm) as total FROM `tabHourly Production` WHERE location=%s AND prod_date BETWEEN %s AND %s AND docstatus<2\", (doc.location, survey_date, doc.prod_date), as_dict=True) %}\r\n    {% set hourly_coal_bcm = hourly_coal[0].total if hourly_coal and hourly_coal[0].total else 0 %}\r\n    {% set hourly_coal_tons = hourly_coal_bcm * 1.5 %}\r\n    {% set total_coal_tons = (survey_tons or 0) + (hourly_coal_tons or 0) %}\r\n    {% set coal_in_cubes = ((survey_tons or 0) / 1.5) + ((hourly_coal_tons or 0) / 1.5) %}\r\n    {% set month_actual_bcm = doc.month_actual_bcm or 0 %}\r\n    {% if total_coal_tons > 0 %}\r\n      {% set calc_strip_ratio = (month_actual_bcm - coal_in_cubes) / total_coal_tons %}\r\n    {% else %}\r\n      {% set calc_strip_ratio = 0 %}\r\n    {% endif %}\r\n\r\n    {% set planning = frappe.db.sql(\"SELECT month_remaining_production_days, month_remaining_prod_hours FROM `tabMonthly Production Planning` WHERE location=%s ORDER BY creation DESC LIMIT 1\", (doc.location,), as_dict=True) %}\r\n    {% set plan_remaining_days = planning[0].month_remaining_production_days if planning and planning[0].month_remaining_production_days else 1 %}\r\n    {% set month_remaining_prod_hours = planning[0].month_remaining_prod_hours if planning and planning[0].month_remaining_prod_hours else 1 %}\r\n    {% set remaining_bcm = (doc.monthly_target_bcm or 0) - (doc.month_actual_bcm or 0) %}\r\n\r\n    <table>\r\n      <tbody>\r\n        <tr><th>Monthly Target BCM</th><td>{{ \"{:,.0f}\".format(doc.monthly_target_bcm or 0) }}</td></tr>\r\n        <tr><th>Daily Target</th><td>{{ \"{:,.0f}\".format(doc.target_bcm_day or 0) }}</td></tr>\r\n        <tr><th>Target Hourly Rate</th><td>{{ \"{:,.0f}\".format(doc.target_bcm_hour or 0) }}</td></tr>\r\n        <tr><th>Production to Date</th><td>{{ \"{:,.0f}\".format(doc.month_actual_bcm or 0) }}</td></tr>\r\n        <tr><th>Remaining BCM</th><td>{{ \"{:,.0f}\".format(remaining_bcm or 0) }}</td></tr>\r\n        <tr><th>Current Rate</th><td>{{ \"{:,.0f}\".format(doc.mtd_bcm_day or 0) }}</td></tr>\r\n        <tr><th>Daily Required Rate</th><td>{{ \"{:,.0f}\".format((remaining_bcm or 0) / (plan_remaining_days or 1)) }}</td></tr>\r\n        <tr><th>Strip Ratio</th><td>{{ \"{:,.0f}\".format(calc_strip_ratio or 0) }}</td></tr>\r\n        <tr><th>Forecasted BCM</th><td>{{ \"{:,.0f}\".format(doc.month_forecated_bcm or 0) }}</td></tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n\r\n<!-- BOTTOM: HOUR SUMMARY -->\r\n<div class=\"bottom-row\">\r\n  <div>\r\n    <div class=\"section-title\">Hour Summary</div>\r\n\r\n    {% set totals = {\"excavator\": 0, \"dozer\": 0} %}\r\n\r\n    {% for row in doc.truck_loads %}\r\n      {% set vol = ((row.loads or 0) * (row.tub_factor or 0)) %}\r\n      {% set _ = totals.update({\"excavator\": totals[\"excavator\"] + vol}) %}\r\n    {% endfor %}\r\n\r\n    {% for row in doc.dozer_production %}\r\n      {% if (row.bcm_hour or 0) > 0 %}\r\n        {% set _ = totals.update({\"dozer\": totals[\"dozer\"] + (row.bcm_hour or 0)}) %}\r\n      {% endif %}\r\n    {% endfor %}\r\n\r\n    {% set shift_docs = frappe.db.sql(\"SELECT SUM(hour_total_bcm) AS total FROM `tabHourly Production` WHERE location=%s AND prod_date=%s AND shift=%s AND docstatus < 2\", (doc.location, doc.prod_date, doc.shift), as_dict=True) %}\r\n    {% set total_shift_bcm = shift_docs[0].total if shift_docs and shift_docs[0].total else 0 %}\r\n\r\n    <table>\r\n      <tbody>\r\n        <tr><th>Total BCM TS</th><td class=\"summary-cell\">{{ \"{:,.0f}\".format(totals[\"excavator\"] or 0) }}</td></tr>\r\n        <tr><th>Total BCM Dozing</th><td class=\"summary-cell\">{{ \"{:,.0f}\".format(totals[\"dozer\"] or 0) }}</td></tr>\r\n        <tr><th>Total Shift Acc BCM</th><td class=\"summary-cell\">{{ \"{:,.0f}\".format(total_shift_bcm or 0) }}</td></tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>\r\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2025-11-07 12:59:51.537906",
 "modified_by": "Administrator",
 "module": "Production",
 "name": "Hourly Production Report",
 "owner": "Administrator",
 "page_number": "Hide",
 "pdf_generator": "wkhtmltopdf",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "show_section_headings": 0,
 "standard": "Yes"
}