{
 "absolute_value": 0,
 "align_labels_right": 0,
 "creation": "2026-01-14 21:57:53.594981",
 "custom_format": 1,
 "default_print_language": "en",
 "disabled": 0,
 "doc_type": "Hourly Drilling Report",
 "docstatus": 0,
 "doctype": "Print Format",
 "font_size": 14,
 "html": "{# =========================================================\r\n   Hourly Drilling Report \u2014 Drilling Shift Summary (A4 Landscape)\r\n   BULLETPROOF VERSION: never queries forbidden fields\r\n   ========================================================= #}\r\n\r\n<style>\r\n  @media print { @page { size: A4 landscape; margin: 6mm; } }\r\n  * { box-sizing: border-box; }\r\n  body { font-family: Arial, Helvetica, sans-serif; font-size: 10px; color: #222; }\r\n\r\n  .title { text-align: center; font-size: 16px; font-weight: 700; margin: 0 0 4px 0; color: #1F4E79; }\r\n  .meta { text-align: center; margin: 0 0 6px 0; white-space: nowrap; font-size: 11px; }\r\n\r\n  .pill{\r\n    display:inline-block; padding: 1px 6px; border: 1px solid #888; border-radius: 4px;\r\n    font-weight: bold; min-width: 18px; text-align:center; background:#fff2cc;\r\n  }\r\n\r\n  table.layout { width: 100%; border-collapse: collapse; }\r\n  td.left { width: 74%; vertical-align: top; padding-right: 8px; }\r\n  td.right { width: 26%; vertical-align: top; }\r\n\r\n  .block { border: 1px solid #1f4e79; margin-bottom: 6px; }\r\n  .block-title { background: #1f4e79; color: #fff; padding: 4px 6px; font-weight: 700; font-size: 11px; }\r\n\r\n  table.tbl { width: 100%; border-collapse: collapse; }\r\n  table.tbl th, table.tbl td { border: 1px solid #1f4e79; padding: 4px; text-align: center; vertical-align: middle; }\r\n  table.tbl th { background: #d9e2f3; font-weight: 700; color: #000; }\r\n\r\n  .right-align { text-align: right; }\r\n\r\n  .stats-label { background: #d9e2f3; font-weight: 700; text-align: left; }\r\n  .stats-value { background: #fff2cc; font-weight: 700; text-align: right; }\r\n\r\n  .stats-section { background: #ffffff; font-weight: 800; text-align: center; }\r\n\r\n  .stats-spacer td{\r\n    background: #ffffff; height: 10px; padding: 0;\r\n    border-left: 1px solid #1f4e79; border-right: 1px solid #1f4e79;\r\n  }\r\n\r\n  input[type=number], input[type=text]{\r\n    width: 100%; box-sizing: border-box; text-align: center; font-weight: bold;\r\n    border: 1px solid #ccc; border-radius: 2px; padding: 2px 2px; font-size: 9px; background: #fff;\r\n  }\r\n\r\n  input.start-hours, input.end-hours{\r\n    font-family: monospace; font-variant-numeric: tabular-nums;\r\n    width: 52px; max-width: 52px; min-width: 52px;\r\n  }\r\n  input.total-hours{\r\n    font-family: monospace; font-variant-numeric: tabular-nums;\r\n    background: #fff2cc;\r\n    width: 42px; max-width: 42px; min-width: 42px;\r\n  }\r\n\r\n  .hours-cell { padding: 3px; }\r\n  .hours-cell.start, .hours-cell.end { width: 62px; }\r\n  .hours-cell.total { width: 52px; }\r\n\r\n  table.tbl td { line-height: 1.15; }\r\n  .block, table { page-break-inside: avoid; }\r\n</style>\r\n\r\n{# ---------- helpers ---------- #}\r\n{% macro fmt0_or_dash(n) -%}\r\n  {{ \"-\" if n is none else \"{:,.0f}\".format(n|float) }}\r\n{%- endmacro %}\r\n\r\n{% macro pick(r, a, b, c, d, e, f) -%}\r\n  {% set v = r.get(a) %}\r\n  {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}\r\n    {% set v = r.get(b) %}\r\n    {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}\r\n      {% set v = r.get(c) %}\r\n      {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}\r\n        {% set v = r.get(d) %}\r\n        {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}\r\n          {% set v = r.get(e) %}\r\n          {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}\r\n            {% set v = r.get(f) %}\r\n            {% if v is not none and (v|string|trim) != \"\" %}{{ v }}{% else %}{{ \"\" }}{% endif %}\r\n          {% endif %}\r\n        {% endif %}\r\n      {% endif %}\r\n    {% endif %}\r\n  {% endif %}\r\n{%- endmacro %}\r\n\r\n{% macro pick_float(r, a, b, c, d, e, f) -%}\r\n  {% set v = r.get(a) %}\r\n  {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}\r\n    {% set v = r.get(b) %}\r\n    {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}\r\n      {% set v = r.get(c) %}\r\n      {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}\r\n        {% set v = r.get(d) %}\r\n        {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}\r\n          {% set v = r.get(e) %}\r\n          {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}\r\n            {% set v = r.get(f) %}\r\n            {% if v is not none and (v|string|trim) != \"\" %}{{ v|float }}{% else %}{{ 0.0 }}{% endif %}\r\n          {% endif %}\r\n        {% endif %}\r\n      {% endif %}\r\n    {% endif %}\r\n  {% endif %}\r\n{%- endmacro %}\r\n\r\n{# =========================================================\r\n   1) Source entries\r\n   ========================================================= #}\r\n{% set entries = doc.hourly_entries or [] %}\r\n\r\n{% set last_hour = namespace(v=\"\") %}\r\n{% for r in entries %}\r\n  {% set h = (pick(r, \"hourly_slot\", \"hour_slot\", \"hour\", \"hours\", \"time_slot\", \"slot\")|string|trim) %}\r\n  {% if h != \"\" %}{% set last_hour.v = h %}{% endif %}\r\n{% endfor %}\r\n\r\n{# =========================================================\r\n   2) Unique drills\r\n   ========================================================= #}\r\n{% set drills_list = [] %}\r\n{% for r in entries %}\r\n  {% set d = (pick(r, \"drills\", \"drill\", \"drill_no\", \"rig\", \"machine\", \"equipment\")|string|trim) %}\r\n  {% if d != \"\" and (d not in drills_list) %}{% set _ = drills_list.append(d) %}{% endif %}\r\n{% endfor %}\r\n\r\n{# =========================================================\r\n   3) Drill rows + material totals\r\n   ========================================================= #}\r\n{% set drill_rows = [] %}\r\n{% set mat_totals = {} %}\r\n{% set shift_total_m = namespace(v=0.0) %}\r\n\r\n{% if drills_list and (drills_list|length > 0) %}\r\n  {% for d in drills_list %}\r\n    {% set agg = namespace(total=0.0, area=\"\", material=\"\") %}\r\n\r\n    {% for r in entries %}\r\n      {% set rd = (pick(r, \"drills\", \"drill\", \"drill_no\", \"rig\", \"machine\", \"equipment\")|string|trim) %}\r\n      {% if rd == d %}\r\n        {% set m = pick_float(r, \"meters\", \"meter\", \"metres\", \"total_meters\", \"drilled_meters\", \"drilling_meters\") %}\r\n        {% set agg.total = agg.total + (m|float) %}\r\n\r\n        {% if (agg.area|trim == \"\") %}\r\n          {% set a = (pick(r, \"mining_area\", \"area\", \"pit\", \"section\", \"location\", \"working_area\")|string|trim) %}\r\n          {% if a != \"\" %}{% set agg.area = a %}{% endif %}\r\n        {% endif %}\r\n\r\n        {% if (agg.material|trim == \"\") %}\r\n          {% set mt = (pick(r, \"material\", \"material_type\", \"ore_type\", \"rock_type\", \"ground_type\", \"mat\")|string|trim) %}\r\n          {% if mt != \"\" %}{% set agg.material = mt %}{% endif %}\r\n        {% endif %}\r\n      {% endif %}\r\n    {% endfor %}\r\n\r\n    {% set row_material = (agg.material or \"-\") %}\r\n    {% set _ = drill_rows.append({\"drill\": d, \"area\": agg.area or \"-\", \"material\": row_material, \"meters\": agg.total}) %}\r\n    {% set shift_total_m.v = shift_total_m.v + agg.total %}\r\n\r\n    {% if not mat_totals.get(row_material) %}\r\n      {% set _ = mat_totals.update({row_material: 0.0}) %}\r\n    {% endif %}\r\n    {% set _ = mat_totals.update({row_material: mat_totals[row_material] + agg.total}) %}\r\n  {% endfor %}\r\n{% endif %}\r\n\r\n{# =========================================================\r\n   4) Monthly Stats (SAFE QUERY)\r\n   NEVER includes forbidden fields\r\n   ========================================================= #}\r\n{% set dp = None %}\r\n{% if doc.drilling_meter_planning %}\r\n  {% set meta = frappe.get_meta(\"Drilling Meter Planning\") %}\r\n  {% set dp_fields = [] %}\r\n\r\n  {% for f in [\r\n    \"monthly_target_meters\",\r\n    \"daily_target_meters\",\r\n    \"current_daily_meters\",\r\n    \"meters_per_drill\",\r\n    \"required_hourly_rate\",\r\n    \"current_hourly_rate\",\r\n    \"mtd_drilled_meters\",\r\n    \"remaining_meter\",\r\n    \"drilling_meters_forecast\"\r\n  ] %}\r\n    {% if meta.has_field(f) %}{% set _ = dp_fields.append(f) %}{% endif %}\r\n  {% endfor %}\r\n\r\n  {% if dp_fields and (dp_fields|length > 0) %}\r\n    {% set dp = frappe.db.get_value(\"Drilling Meter Planning\", doc.drilling_meter_planning, dp_fields, as_dict=1) %}\r\n  {% endif %}\r\n{% endif %}\r\n\r\n<div class=\"title\">Drilling Shift Summary</div>\r\n\r\n<div class=\"meta\">\r\n  <b>Site:</b> {{ doc.site or \"-\" }}\r\n  &nbsp;|&nbsp;\r\n  <b>Shift:</b> <span class=\"pill\">{{ doc.shift or \"-\" }}</span>\r\n  &nbsp;|&nbsp;\r\n  <b>Date:</b> {{ doc.date or \"-\" }}\r\n  &nbsp;|&nbsp;\r\n  <b>Last Hour:</b> {{ last_hour.v or \"-\" }}\r\n</div>\r\n\r\n<table class=\"layout\">\r\n<tr>\r\n\r\n  <td class=\"left\">\r\n    <div class=\"block\">\r\n      <div class=\"block-title\">Drill Production (Full Shift: First Hour \u2192 Last Hour)</div>\r\n      <table class=\"tbl\" id=\"drill-production-table\">\r\n        <thead>\r\n          <tr>\r\n            <th style=\"width: 64px;\">Drills</th>\r\n            <th>Mining<br>Area</th>\r\n            <th>Material</th>\r\n            <th style=\"width: 56px;\">Meters</th>\r\n            <th style=\"width: 62px;\">Start<br>Hours</th>\r\n            <th style=\"width: 62px;\">End<br>Hours</th>\r\n            <th style=\"width: 52px;\">Total<br>Hours</th>\r\n          </tr>\r\n        </thead>\r\n        <tbody>\r\n          {% if drill_rows and (drill_rows|length > 0) %}\r\n            {% for row in drill_rows %}\r\n              <tr>\r\n                <td>{{ row.drill }}</td>\r\n                <td>{{ row.area }}</td>\r\n                <td>{{ row.material }}</td>\r\n                <td class=\"right-align\">{{ fmt0_or_dash(row.meters) }}</td>\r\n                <td class=\"hours-cell start\"><input type=\"number\" step=\"1\" class=\"start-hours\" placeholder=\"0\"></td>\r\n                <td class=\"hours-cell end\"><input type=\"number\" step=\"1\" class=\"end-hours\" placeholder=\"0\"></td>\r\n                <td class=\"hours-cell total\"><input type=\"text\" class=\"total-hours\" placeholder=\"0\" readonly></td>\r\n              </tr>\r\n            {% endfor %}\r\n          {% else %}\r\n            <tr><td colspan=\"7\">No Drill Data Found</td></tr>\r\n          {% endif %}\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n\r\n    <div class=\"block\">\r\n      <div class=\"block-title\">Shift Report</div>\r\n      <table class=\"tbl\">\r\n        <tbody>\r\n          <tr>\r\n            <td class=\"stats-label\" colspan=\"2\" style=\"text-align:center;\">DRILLED MATERIAL (Total Meters)</td>\r\n          </tr>\r\n\r\n          {% if mat_totals and (mat_totals|length > 0) %}\r\n            {% for m, total in mat_totals.items() %}\r\n              <tr>\r\n                <td class=\"stats-label\">{{ m }}</td>\r\n                <td class=\"stats-value\">{{ fmt0_or_dash(total) }}</td>\r\n              </tr>\r\n            {% endfor %}\r\n          {% else %}\r\n            <tr><td class=\"stats-label\">-</td><td class=\"stats-value\">-</td></tr>\r\n          {% endif %}\r\n\r\n          <tr>\r\n            <td class=\"stats-label\">Total Shift Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(shift_total_m.v) }}</td>\r\n          </tr>\r\n\r\n          <tr>\r\n            <td class=\"stats-label\">Diesel_used</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(doc.diesel_used) }}</td>\r\n          </tr>\r\n\r\n          <tr>\r\n            <td class=\"stats-label\">Water_used</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(doc.water_used) }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </td>\r\n\r\n  <td class=\"right\">\r\n    <div class=\"block\">\r\n      <div class=\"block-title\">Monthly Statistics</div>\r\n      <table class=\"tbl\">\r\n        <tbody>\r\n          <tr>\r\n            <td class=\"stats-label\">Monthly Target Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"monthly_target_meters\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Daily Target Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"daily_target_meters\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Current Daily Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"current_daily_meters\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Meters Per Drill</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"meters_per_drill\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n\r\n          <tr>\r\n            <td class=\"stats-section\" colspan=\"2\">Penetration Hourly Rate</td>\r\n          </tr>\r\n\r\n          <tr>\r\n            <td class=\"stats-label\">Required Hourly Rate</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"required_hourly_rate\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Current Hourly Rate</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"current_hourly_rate\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n\r\n          <tr class=\"stats-spacer\"><td colspan=\"2\"></td></tr>\r\n\r\n          <tr>\r\n            <td class=\"stats-label\">MTD Drilled Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"mtd_drilled_meters\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Remaining Meters</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"remaining_meter\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n          <tr>\r\n            <td class=\"stats-label\">Drilling Meters Forecast</td>\r\n            <td class=\"stats-value\">{{ fmt0_or_dash(dp.get(\"drilling_meters_forecast\")) if dp else \"-\" }}</td>\r\n          </tr>\r\n        </tbody>\r\n      </table>\r\n    </div>\r\n  </td>\r\n\r\n</tr>\r\n</table>\r\n\r\n<script>\r\n  function calcRowTotal(tr) {\r\n    const startEl = tr.querySelector('input.start-hours');\r\n    const endEl   = tr.querySelector('input.end-hours');\r\n    const totalEl = tr.querySelector('input.total-hours');\r\n    if (!startEl || !endEl || !totalEl) return;\r\n\r\n    const sRaw = startEl.value;\r\n    const eRaw = endEl.value;\r\n\r\n    if (sRaw === \"\" || eRaw === \"\") { totalEl.value = \"\"; return; }\r\n\r\n    const s = parseFloat(sRaw);\r\n    const e = parseFloat(eRaw);\r\n    if (isNaN(s) || isNaN(e)) { totalEl.value = \"\"; return; }\r\n\r\n    totalEl.value = Math.round(e - s);\r\n  }\r\n\r\n  document.addEventListener('input', function(ev) {\r\n    if (!ev.target) return;\r\n    if (ev.target.classList.contains('start-hours') || ev.target.classList.contains('end-hours')) {\r\n      const tr = ev.target.closest('tr');\r\n      if (tr) calcRowTotal(tr);\r\n    }\r\n  }, true);\r\n\r\n  setTimeout(function() {\r\n    document.querySelectorAll('#drill-production-table tbody tr').forEach(calcRowTotal);\r\n  }, 300);\r\n</script>\r\n",
 "idx": 0,
 "line_breaks": 0,
 "margin_bottom": 15.0,
 "margin_left": 15.0,
 "margin_right": 15.0,
 "margin_top": 15.0,
 "modified": "2026-01-30 10:14:42.003580",
 "modified_by": "Administrator",
 "module": "Production",
 "name": "Hourly Drilling Summary",
 "owner": "Administrator",
 "page_number": "Hide",
 "pdf_generator": "wkhtmltopdf",
 "print_format_builder": 0,
 "print_format_builder_beta": 0,
 "print_format_for": "DocType",
 "print_format_type": "Jinja",
 "raw_printing": 0,
 "report": "Production Report",
 "show_section_headings": 0,
 "standard": "Yes"
}
